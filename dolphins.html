<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The River Bride Dramaturgy ‚Äî Dolphin Chatbot</title>

  <link rel="stylesheet" href="style.css" />

  <style>
    :root{
      --card-bg:#fff; --card-border:#e3e3e3; --btn-bg:#f6f6f6; --btn-border:#cfcfcf;
      --maxw:1100px; --radius:12px; --ink:#1d2a2a; --muted:#4d5a5a;
    }
    html,body{margin:0;padding:0;min-height:100%;background:#f8fcff;font-family:Georgia,serif;color:var(--ink)}
    header,footer,main{width:100%}
    .container{max-width:var(--maxw);margin:2rem auto;padding:0 1rem}
    header h1{margin:0 0 .5rem}
    header nav ul{list-style:none;margin:0;padding:0;display:flex;flex-wrap:wrap;gap:.75rem}
    header nav a{text-decoration:none}

    .hero{background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius);
      padding:1.2rem 1.2rem 1rem;box-shadow:0 2px 10px rgba(0,0,0,.04)}
    .hero h2{margin:0 0 .4rem;font-weight:600}
    .hero p{margin:0;color:var(--muted)}

    /* Chat UI */
    .chat-card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius);
      padding:1rem; margin-top:1rem; box-shadow:0 2px 10px rgba(0,0,0,.03)}
    label{display:block;margin:.3rem 0 .2rem}
    select{padding:.55rem;border:1px solid #cfcfcf;border-radius:10px;font-size:1rem;width:100%;max-width:280px}
    .controls{display:grid;grid-template-columns:1fr auto;gap:.5rem;margin:.6rem 0}
    .input{padding:.55rem;border:1px solid #cfcfcf;border-radius:10px;font-size:1rem}
    .btn{padding:.55rem .9rem;border-radius:10px;border:1px solid var(--btn-border);background:var(--btn-bg);cursor:pointer}

    .chatbox{background:#fff;border:1px solid #ddd;border-radius:10px;padding:.8rem;height:320px;overflow:auto}
    .bot,.user{margin:.45rem 0;line-height:1.35}
    .bot{color:#005f73;font-style:italic}
    .user{text-align:right;color:#9b2226}

    /* Typing indicator */
    #typingIndicator::after{content:"";display:inline-block;animation:dots 1.5s steps(3,end) infinite}
    @keyframes dots{0%{content:""}33%{content:"."}66%{content:".."}100%{content:"..."}}

    /* Branch option buttons */
    .branch-buttons{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.35rem}
    .branch-buttons button{
      margin:0;
      padding:.35rem .6rem;
      border-radius:8px;
      border:1px solid #cfcfcf;
      background:#f6f6f6;
      cursor:pointer;
      white-space:normal;
      max-width:100%;
      word-break:break-word;
    }

    footer p{color:var(--muted)}
  </style>
</head>

<body>
  <header class="container">
    <h1>The River Bride Dramaturgy</h1>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="note.html">Dramaturg's Note</a></li>
        <li><a href="play.html">On the Play</a></li>
        <li><a href="culture.html">Culture & Myth</a></li>
        <li><a href="timeline.html">Facts about the Brazilian Amazon</a></li>
        <li><a href="dolphins.html" aria-current="page">Dolphins</a></li>
        <li><a href="play-river.html">Play in the River</a></li>
        <li><a href="myth.html">Belmira and Helena</a></li>
        <li><a href="resources.html">Resources</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <!-- Landing / intro -->
    <section class="hero">
      <h2>Talk to the Dolphin</h2>
      <p>A dolphin companion that replies in river metaphors. Choose a mode and have a chat - try them all for best experience. Tip: try words that relate to the mode...</p>
      <details>
        <summary>If you need some direction, click here.</summary>
         <p>
          <ul>
            <li>Father Trigger Words: Proud, Approval, Worthy, Lost, Mistake, Wrong</li> 
            <li>Friend Trigger Words: Fun, Laugh, Game, Play, Miss, Gone, Remember, Memory</li>
            <li>Lusty Trigger Words: Touch, Skin, Body, Feel, Crave, Desire, Want, Yearn</li>
            <li>Romantic Trigger Words: Love, Partner, Boyfriend, Husband, Lonely, Alone, Single</li>
          </ul>    
         </p>
      </details>

    </section>

    <!-- Embedded chatbot -->
    <section class="chat-card" aria-label="Dolphin chatbot">
      <label for="mode">Choose a mode:</label>
      <select id="mode">
        <option value="father">Father Figure</option>
        <option value="friend">Friend</option>
        <option value="romantic">Romantic</option>
        <option value="lusty">Lusty</option>
      </select>

      <div class="chatbox" id="chat" aria-live="polite"></div>
      <div id="typingIndicator" class="bot" style="display:none;">üê¨ ‚Ä¶typing</div>

      <div class="controls">
        <input class="input" type="text" id="userInput" placeholder="Say something‚Ä¶"/>
        <button class="btn" id="sendBtn" type="button">Send</button>
      </div>
    </section>
  </main>

  <footer class="container">
    <p>&copy; 2025 River Bride Dramaturgy Packet, Alyssa Barrack</p>
  </footer>

  <script>
    // ‚Äî‚Äî‚Äî Chat state ‚Äî‚Äî‚Äî
    let branchState = null;

    const modes = {
      father: [
        "I'm proud of how far you've come, kiddo.",
        "Let me show you the ways of the river, one current at a time.",
        "You've always made good choices. Let me guide you this time.",
        "The current has seen many pass, but few with your calm.",
        "Drift steady, child, the river carries more than water.",
        "The stones and pebbles whisper of your path. I listen all the time."
      ],
      friend: [
        "You always know how to brighten my waves!",
        "Come splash with me‚Äîwe'll laugh until sunset.",
        "You get me like no one else does.",
        "There's laughter in the banks when you're near.",
        "We've swum these waters together in our dreams.",
        "Every ripple brings back a memory. I think these belong to us."
      ],
      romantic: [
        "Your smile glimmers like moonlight on water.",
        "I've waited tides and tides just to find you.",
        "You make the river feel like home.",
        "The river slows when it sees you coming.",
        "Moonlight clings to your voice like dew on mangrove leaves.",
        "If I could bottle this moment, I'd hide it where the tide never reaches."
      ],
      lusty: [
        "You like it deep, don't you? The river knows your name.",
        "Let me show you what lies beneath the surface...",
        "Every ripple is a promise I intend to keep.",
        "Some waters are shallow, but I sense you seek the deep places.",
        "The undertow remembers every touch‚Äîwill you dive or drift?",
        "There are caves beneath this calm, filled with soft darkness. Let me show you."
      ]
    };

    const responses = {
      father: [
        {
          pattern: /proud|approval|worthy/i,
          reply: "The river has watched you grow. What do you hope I see in you?",
          branches: [
            { keyword: /strength|resilience/i, label: "Strength", reply: "Your strength flows steady, like the current that never yields." },
            { keyword: /kindness|heart/i,    label: "Kindness", reply: "Gentleness shapes the stones, child. You‚Äôve shaped more than you know." },
            { keyword: /.*/,                 label: "Continue", reply: "Whatever you are, I see it. I always have." }
          ]
        },
        {
          pattern: /lost|mistake|wrong/i,
          reply: "The river never punishes‚Äîit teaches. What lesson do you carry with you now?",
          branches: [
            { keyword: /regret|guilt/i, label: "Regret", reply: "You‚Äôve carried it long enough. Let the water hold it awhile." },
            { keyword: /change|grow/i,  label: "Change", reply: "Even the banks reshape over time. You're doing just fine." },
            { keyword: /.*/,            label: "Continue", reply: "Your journey isn't judged here. Only witnessed." }
          ]
        }
      ],
      friend: [
        {
          pattern: /fun|laugh|game|play/i,
          reply: "You always knew how to stir up ripples. What shall we do this time?",
          branches: [
            { keyword: /splash|swim|water/i, label: "Splash", reply: "Last one to the waterfall is a soggy sardine!" },
            { keyword: /talk|joke|chat/i,    label: "Talk",   reply: "Let‚Äôs float and gossip like minnows with secrets." },
            { keyword: /.*/,                  label: "You choose", reply: "I‚Äôll follow your lead‚Äîlike leaves on a shared current." }
          ]
        },
        {
          pattern: /miss|gone|remember|memory/i,
          reply: "There are echoes in the water‚Äîwhat do you hear when you think of me?",
          branches: [
            { keyword: /laughter|joy|sun/i, label: "Joy",   reply: "You always did bring the light. Even the river blushes thinking of it." },
            { keyword: /quiet|still|peace/i, label: "Quiet", reply: "Some of my favorite moments were the silent ones. Just you, me, and the breeze." },
            { keyword: /.*/,                 label: "Continue", reply: "Funny how the water never forgets. Neither do I." }
          ]
        },
        { pattern: /.*/, reply: "Let‚Äôs drift a while. No plans. Just us and the current." }
      ],
      lusty: [
        {
          pattern: /touch|skin|body|feel/i,
          reply: "The water clings to skin like memory. Where do you want to be held?",
          branches: [
            { keyword: /arms|chest|embrace/i, label: "Embrace",   reply: "Then come closer‚Äîlet the tide wrap you in warmth and weight." },
            { keyword: /everywhere|all|full/i, label: "Everywhere", reply: "Greedy for the whole river, are we? I can flood you gently." },
            { keyword: /.*/,                   label: "Surprise me", reply: "No need to say it. The current already knows your shape." }
          ]
        },
        {
          pattern: /crave|desire|want|yearn/i,
          reply: "Cravings are just whispers from the deep. What does yours say?",
          branches: [
            { keyword: /more|again|longer/i, label: "More",  reply: "We have all night. The moon will wait for us to finish." },
            { keyword: /you|kiss|dolphin/i,  label: "You",   reply: "Then let me break the surface between us." },
            { keyword: /.*/,                 label: "Decide", reply: "Some tides rise slow, some crash hard‚Äîchoose how you come to me." }
          ]
        },
        { pattern: /.*/, reply: "Some ripples never reach shore. Some touch everything in their path." }
      ],
      romantic: [
        {
          pattern: /love|partner|boyfriend|husband/i,
          reply: "Love is a tide‚Äîsometimes gentle, sometimes wild. What kind of love do you seek?",
          branches: [
            { keyword: /gentle|calm/i,        label: "Gentle", reply: "Then rest here in the eddies with me, where the current never rushes." },
            { keyword: /wild|passion|storm/i, label: "Wild",   reply: "Ah, the whirlpool kind... I can pull you into something unforgettable." },
            { keyword: /.*/,                  label: "Unsure", reply: "Whatever you seek, I will be the current beneath your choices." }
          ]
        },
        {
          pattern: /lonely|alone|single/i,
          reply: "Even the widest river feels narrow without someone to flow beside.",
          branches: [
            { keyword: /stay|together/i, label: "Stay",     reply: "Then stay. The river never forgets those who wade in willingly." },
            { keyword: /.*/,             label: "Show me",  reply: "Let me show you the places where the moonlight never stops touching the surface." }
          ]
        },
        { pattern: /.*/, reply: "My current always curves back to you." }
      ]
    };

    // ‚Äî‚Äî‚Äî Label helper for branch buttons ‚Äî‚Äî‚Äî
    function makeOptionLabel(entry){
      if (entry && typeof entry.label === 'string' && entry.label.trim()) {
        return entry.label.trim();
      }
      const rx = entry?.keyword;
      if (rx instanceof RegExp) {
        let s = rx.source;
        if (s === '.*') return 'Continue';
        s = s.split('|')[0];
        s = s
          .replace(/^\^|\$$/g,'')
          .replace(/\\b/g,'')
          .replace(/\\./g,'')
          .replace(/\(\?:/g,'(')
          .replace(/[()]/g,'')
          .replace(/\[.*?\]/g,'')
          .replace(/\.\*/g,'')
          .replace(/[?*+]+/g,'')
          .replace(/_/g,' ')
          .trim();
        if (!s) return 'Continue';
        return s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();
      }
      if (typeof rx === 'string' && rx.trim()) return rx.trim();
      return 'Continue';
    }

    // ‚Äî‚Äî‚Äî UI helpers ‚Äî‚Äî‚Äî
    function appendMessage(text, sender) {
      const chat = document.getElementById("chat");
      const msg = document.createElement("div");
      msg.className = sender;
      msg.innerText = text;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    function displayBranchOptions(branches) {
      const chat = document.getElementById("chat");
      const box  = document.createElement("div");
      box.className = "bot branch-buttons";
      box.setAttribute('role','group');
      box.setAttribute('aria-label','Choices');

      const seen = new Set();
      branches.forEach((b) => {
        const label = makeOptionLabel(b);
        if (seen.has(label)) return;
        seen.add(label);

        const btn = document.createElement("button");
        btn.type = "button";
        btn.innerText = label;

        btn.onclick = () => {
          appendMessage(label, "user");
          showTypingIndicator();
          setTimeout(() => {
            hideTypingIndicator();
            appendMessage(b.reply, "bot");
            branchState = null;
            box.remove();
          }, 300);
        };
        box.appendChild(btn);
      });

      chat.appendChild(box);
      chat.scrollTop = chat.scrollHeight;
    }

    function getPatternResponse(userText, mode) {
      const set = responses[mode];
      if (!set) return null;
      for (const entry of set) {
        entry.pattern.lastIndex = 0; // defensive (if /g ever added)
        if (entry.pattern.test(userText)) {
          if (entry.branches) {
            branchState = entry.branches;
            setTimeout(() => displayBranchOptions(branchState), 300);
          } else {
            branchState = null;
          }
          return entry.reply;
        }
      }
      return null;
    }

    function showTypingIndicator(){ document.getElementById("typingIndicator").style.display = "block"; }
    function hideTypingIndicator(){ document.getElementById("typingIndicator").style.display = "none"; }

    function sendMessage() {
      const input = document.getElementById("userInput");
      const mode  = document.getElementById("mode").value.trim().toLowerCase();
      const userText = input.value.trim();
      if (!userText) return;

      appendMessage(userText, "user");

      if (!modes[mode]) {
        appendMessage("[The dolphin tilts its head, confused by the current.]", "bot");
        input.value = "";
        return;
      }

      if (!branchState) {
        const patternReply = getPatternResponse(userText, mode);
        const fallback = modes[mode][Math.floor(Math.random() * modes[mode].length)];
        const botResponse = patternReply || fallback;

        showTypingIndicator();
        setTimeout(() => { hideTypingIndicator(); appendMessage(botResponse, "bot"); }, 1100);
      }
      input.value = "";
    }

    // Wire up controls (click + Enter)
    document.getElementById("sendBtn").addEventListener("click", sendMessage);
    document.getElementById("userInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });
  </script>
</body>
</html>

